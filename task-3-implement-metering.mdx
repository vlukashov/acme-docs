---
title: "Task 3: Implement Metering"
---

## Overview

This guide provides step-by-step instructions for implementing metering for your MCSP subscription. Metering enables accurate monitoring, tracking, and reporting of usage data.

**Note** Use of the metering API requires that the tasks above, product registration and CSB boarding are complete.

## Developers getting started implementation steps

### Step 1 Create Metering Configuration

To enable metering, define the metering configuration in your _Product Registration_ YAML file. This configuration instructs MCSP metering service on how to track and process usage data.

Please note: Metering configuration varies by use case (e.g., contract subscription, pay-as-you-go subscription, Acme Cloud usage, or non-Acme Cloud usage).

(1a). For contract-based MCSP subscriptions using the Metering service, ensure your _Product Registration_ YAML file is configured with the following fields. Refer to our [Product Registration CR Doc](./examples/cr-docs/product-registration.md)
for complete guidance on how to fill in all the fields.

```
Required fields
   - **productID**
   - **serviceID**
   - **usageSource**: This field is used to indicate the source where the Metering service(CMM) can pull usage data from. Currently supported values are prometheus and api.
   - **meteringEnabled**: This field is used to determine if the product will onboard to MCSP Metering service _Consumption Metrics Monitor (CMM)_.
   - **meteringEmailTemplates**: This section is used by CMM to send metering email notifications through SendGrid.
   - **overageEmailTemplates**: This section is used by CMM to send overage email notification through SendGrid.
   - **partType**
   - **billingType**: This field is used to check the subscription's billing type.
   - **partPeriod**: This is used by MCSP CMM team to determine subscription's usage enforcement period.
   - **metrics**: This defines the metrics associated with the part number.
   - **durationThresholds**: This value is determined by the service's product team and defines all duration-based thresholds that your service needs to monitor.
   - **consumptionThresholds**: This value is determined by the service's product team and defines how usage consumption should be monitored by CMM.

Optional fields
   - **contractUsageToSWC**: This field is used to indicate whether the contract usage needs to be forwarded to Software Central or not.
   - **usageReset**: This field is used to support usage reset notifications.
   - **CalendarBasedUsageReset**: This flag is used by the MCSP CMM to determine whether a subscription’s usage enforcement period should be based on the calendar month (true) or the subscription start date (false).
   - **suiteEmailTemplates**: This field is used to support Product Suite email templates. This is only required when using Product Suite.
   - **suiteOverageEmailTemplates**: This section is used by Consumption Metrics Monitor (CMM) to send suite overage email notification through SendGrid.
```

(1b). Once the _Product Registration_ YAML file is configured, sync it with ArgoCD to update the _Product Registration_ CR.
For detailed instructions on syncing your YAML with ArgoCD, please refer to the [Product Registration onboarding doc](https://github.acme.com/acme-saas-platform/MultiCloud-SaaS-Framework/blob/main/docs/MCSP_Services/Development_Services/product_registration.md).

### Step 2 Submit Metering Data

Use the REST API to send usage records to the metering API endpoint.

(2a). To access the Metering API, products are required to use API keys. Refer to this [instruction page](https://pages.github.acme.com/acme-saas-platform/platform-sre-runbook/runbook/processes/platform-service-id-apikey/?h=apikey) to obtain your API key.

(2b). Refer to this [instruction page](<https://pages.github.acme.com/acme-saas-platform/account-iam-apidoc/#tag/AssistantKey-(Public)/paths/~1api~12.0~1%7BscopeCollectionType%7D~1%7BscopeId%7D~1assistantKeys~1token/post>) to use your API key to generate an access token.

(2c). Once you have generated your access token, use it to submit usage data to the Metering API. - Refer to our [playbook examples](https://pages.github.acme.com/acme-saas-platform/MultiCloud-SaaS-Framework/MCSP_Services/Development_Services/metering_apis/api_3.0_metering_examples/) for guidance on submitting usage according to your specific use case. We recommend using API version 3.0, the latest and most up-to-date release. - Metering API endpoints are environment-specific—please consult the [endpoint list](https://pages.github.acme.com/acme-saas-platform/MultiCloud-SaaS-Framework/MCSP_Services/Development_Services/metering_apis/api_metering/) and ensure you use the correct endpoint for your environment. - The Metering POST API accepts usage data only for the 24-hour period preceding the current time.

### Step 3: Validate Metering Data

After submitting usage, validate it using the self-serve GET APIs.

(3a). Confirm that raw usage has been received and stored in our Metering database using [GET Raw Usage API by Transaction ID](https://pages.github.acme.com/acme-saas-platform/consumption-metrics-backend/#operation/UsageByTransactionQueryParams) or [GET Raw Usage API by Instance ID](https://pages.github.acme.com/acme-saas-platform/consumption-metrics-backend/#operation/GetInstanceUsagePayloadV3).

(3b). Verify that your usage has been processed by Metering serivce (CMM) and view the correct aggregated daily usage using the [GET Daily Usage API by Instance ID](https://pages.github.acme.com/acme-saas-platform/consumption-metrics-backend/#operation/GetDailyInstanceUsagePayloadV3). - The Metering service (CMM) checks contract subscription usage once per day and aggregates the full-day usage from the previous day. For example, on June 20 it processes usage for June 19. Usage already checked within the past 24 hours is not reprocessed.

(3c). Validate aggregated monthly and total usage using the [GET Monthly Usage API](https://pages.github.acme.com/acme-saas-platform/consumption-metrics-backend/#operation/UsageQueryParamsV1).

Please refer to the [playbook examples](https://pages.github.acme.com/acme-saas-platform/MultiCloud-SaaS-Framework/MCSP_Services/Development_Services/metering_apis/api_metering/) for comprehensive guidance and sample requests for each of the Metering APIs.

### Step 4: View Data in SaaS Management Console

Visit the MCSP SaaS console to see the metering information you have submitted. This UI provides:

- Real-time usage dashboards
- Historical usage trends
- Billing information
- Usage analytics

## Next Steps

Once onboarding to metering is complete, you can proceed to how to [Implement the login button](./task-4-login-button)
